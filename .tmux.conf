unbind r
# manually link from .config in case something goes wrong (this is stupid)
bind r source-file ~/.tmux.conf

unbind C-b
set -g prefix C-Space
bind c new-window -c "#{pane_current_path}"
set -g default-command /bin/zsh
set-option -g renumber-windows on
set -g base-index 1 # start windows numbering at 1
set-option -g mouse on

##
## keybindings
##

# vim keybinds
setw -g mode-keys vi
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R

# split window
bind-key -n M-J split-window -v -c "#{pane_current_path}"
bind-key -n M-L split-window -h -c "#{pane_current_path}"

# resize panes
bind-key -n M-W resize-pane -U 
bind-key -n M-S resize-pane -D 
bind-key -n M-A resize-pane -L 
bind-key -n M-D resize-pane -R 

# window focus
bind-key -n M-z resize-pane -Z

# floating terminals
bind-key -n M-f run-shell "~/.config/tmux_scripts/tmuxpopup"
bind-key -n M-c run-shell "~/.config/tmux_scripts/tmuxpopup-ephemeral"

# create new window from pane's cwd in session float
bind-key f run-shell 'tmux new-window -t float: -c "$(tmux display-message -p "#{pane_current_path}")" && ~/.config/tmux_scripts/tmuxpopup'

# choose session
bind-key -n M-s run-shell "~/.config/tmux_scripts/tmux-session-ls"
bind-key -n M-w run-shell "~/.config/tmux_scripts/tmux-window-ls"

# mouse click on status-left to choose session
bind-key -n MouseDown3StatusLeft run-shell '~/.config/tmux_scripts/tmux-status-session-ls'

# break pane into new window
bind q break-pane\; move-window -r

# send to prev/next window

# next window
bind-key -n M-e if-shell 'tmux has-session -t :+1' 'join-pane -h -t :+1' 'new-window -d -t +1; join-pane -h -t :-1'

# prev window
bind-key -n M-q if-shell 'tmux has-session -t :-1' 'join-pane -h -t :-1' 'new-window -d -t -1; join-pane -h -t :+1'

# send pane to 'n' window
bind-key -n M-n run-shell "~/.config/tmux_scripts/tmux-pane-to-window"

# send pane to session
bind-key -n M-N run-shell "~/.config/tmux_scripts/tmux-pane-to-session"

# swap windows
bind-key -n M-, swap-window -t -1\; select-window -t -1
bind-key -n M-. swap-window -t +1\; select-window -t +1

# swap panes
bind-key -n M-< swap-pane -U
bind-key -n M-> swap-pane -D

# tree view
# bind-key -n M-W choose-window
# bind-key -n M-S choose-session
bind-key t choose-tree

# main if >=3 panes, even otherwise
bind-key -n M-V if-shell '[ #{window_panes} -gt 2 ]' 'select-layout main-vertical' 'select-layout even-vertical'
bind-key -n M-H if-shell '[ #{window_panes} -gt 2 ]' 'select-layout main-horizontal' 'select-layout even-horizontal'
bind-key -n M-C-v select-layout main-vertical-mirrored
bind-key -n M-C-h select-layout main-horizontal-mirrored
bind-key -n M-v select-layout tiled

bind-key -n M-\; previous-window
bind-key -n M-\' next-window

bind-key -n M-1 select-window -t:=1
bind-key -n M-2 select-window -t:=2
bind-key -n M-3 select-window -t:=3
bind-key -n M-4 select-window -t:=4
bind-key -n M-5 select-window -t:=5
bind-key -n M-6 select-window -t:=6
bind-key -n M-7 select-window -t:=7
bind-key -n M-8 select-window -t:=8
bind-key -n M-9 select-window -t:=9

# switch sessions
bind-key -n M-\: switch-client -p
bind-key -n M-\[ switch-client -p
bind-key -n M-\" switch-client -n
bind-key -n M-\] switch-client -n

# new session
bind-key C command-prompt "new -s '%%'"

# reorder sessions: recreate float to be first (session ID $0)
# this makes float appear leftmost in status-left and first in switch-client order
bind-key R confirm-before -p "recreate 'float' session as first? (y/n)" "\
    run-shell '\
        if tmux has-session -t float 2>/dev/null; then \
            tmux kill-session -t float; \
        fi; \
        tmux new-session -d -s float -c ~; \
    '"

##
## status bar
##

set-option -g status-position bottom
set -g status on

set -g status-style bg=default
set -g status-justify absolute-centre

set -g status-left-length 50
set -g status-right-length 50
# set -g status-left "#[fg=#656a80][#{S:#{?#{==:#{session_name},#{client_session}}, #[fg=#a9b1d6]#[underscore]*#[none]#[fg=#656a80] , * }}]"
# set -g status-right "#[fg=#656a80]#{s|$HOME|~|:#{d:pane_current_path}}/#[fg=#a9b1d6]#{b:pane_current_path}"
set -g status-right "#(p='#{pane_current_path}'; p=\"\${p/#\$HOME/~}\"; c=\$(echo \"\$p\" | tr -cd '/' | wc -c); if [ \"\$c\" -le 2 ]; then if [ \"\$p\" = \"~\" ]; then echo \"#[fg=#a9b1d6]~\"; else d=\$(echo \"\$p\" | sed 's|/[^/]*\$||'); b=\$(echo \"\$p\" | sed 's|.*/||'); echo \"#[fg=#656a80]\${d}/#[fg=#a9b1d6]\${b}\"; fi; else l=\$(echo \"\$p\" | rev | cut -d'/' -f1-3 | rev); d=\$(echo \"\$l\" | rev | cut -d'/' -f2-3 | rev); b=\$(echo \"\$l\" | rev | cut -d'/' -f1 | rev); echo \"#[fg=#656a80]...\/\${d}/#[fg=#a9b1d6]\${b}\"; fi | head -c 80)"

# different icons
# set -g status-left "#[fg=#656a80][#{S:#{?#{window_zoomed_flag},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#8fb995]#[underscore]✦#[none]#[fg=#656a80] , ✦ },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#8fb995]#[underscore]✧#[none]#[fg=#656a80] , ✧ },#{?#{==:#{session_name},#{client_session}}, #[fg=#8fb995]#[underscore]*#[none]#[fg=#656a80] , * }}},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#f5919b]#[underscore]✦#[none]#[fg=#656a80] , ✦ },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#92a2d5]#[underscore]✧#[none]#[fg=#656a80] , ✧ },#{?#{==:#{session_name},#{client_session}}, #[fg=#bb9af7]#[underscore]*#[none]#[fg=#656a80] , * }}}}}] #S"

# just stars, color doesnt change
# set -g status-left "#[fg=#656a80][#{S:#{?#{==:#{session_name},#{client_session}}, #[fg=#bb9af7]#[underscore]*#[none]#[fg=#656a80] , * }}] #S"

# just stars, colors match
set -g status-left "#[fg=#656a80][#{S:#{?#{window_zoomed_flag},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#8fb995]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#8fb995]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},#{client_session}}, #[fg=#8fb995]#[underscore]*#[none]#[fg=#656a80] , * }}},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#f5919b]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#92a2d5]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},#{client_session}}, #[fg=#bb9af7]#[underscore]*#[none]#[fg=#656a80] , * }}}}}] #S"

# show current dir
bind-key D display-message "#(echo #{pane_current_path} | sed 's#$HOME#~#g')"

# bind-key R rename-window '#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}'
bind-key W command-prompt -I "#W" "rename-window '%%'"
bind-key S command-prompt -I "#S" "rename-session '%%'"

setw -g pane-border-status bottom
setw -g pane-border-format ""
# setw -g pane-active-border-style "#{?#{==:#{session_name},float},fg=#f5919b,#{?#{==:#{session_name},ephemeral},fg=#92a2d5 ,fg=#bb9af7}}"
setw -g pane-active-border-style "#{?#{window_zoomed_flag},fg=#8fb995,#{?#{==:#{session_name},float},fg=#f5919b,#{?#{==:#{session_name},ephemeral},fg=#92a2d5,fg=#bb9af7}}}"
setw -g pane-border-style "fg=#656a80"
setw -g pane-border-lines "single"
setw -g pane-border-indicators "off"
setw -g pane-scrollbars "modal"
setw -g pane-scrollbars-style "fg=#656a80"

setw -g message-style "fg=#a9b1d6"
setw -g cursor-style underline
set -g prompt-cursor-colour "#a9b1d6"

##
## window styling
##

# set-option -g automatic-rename on
# set-option -g automatic-rename-format '#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}'

# Set the foreground/background color for the active window
setw -g window-active-style "bg=#131313"

# Set the foreground/background color for all other windows
setw -g window-style "bg=#111111"

# set -g window-status-current-format "#[bold]#{?#{e|>=:#{client_width},100}, #{pane_current_command} #[fg=#826bac]#[none][#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] , [#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] }"
# set -g window-status-format "#[fg=#a9b1d6]#{?#{e|>=:#{client_width},100}, #{pane_current_command} #[fg=#656a80]#[none][#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] , [#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] }"

set -g window-status-current-format "#{?#{e|<:#{client_width},50}, #[bold]#I ,#[bold]#{?#{window_zoomed_flag},#{?#{e|>=:#{client_width},100}, #[fg=#8fb995]#I #[fg=#6b8a73][#{pane_current_command}] , #[fg=#8fb995]#I [#{pane_current_command}] },#{?#{e|>=:#{client_width},100}, #{?#{==:#{session_name},float},#[fg=#f5919b]#I #[fg=#936057][#{pane_current_command}],#{?#{==:#{session_name},ephemeral},#[fg=#92a2d5]#I #[fg=#4D6180][#{pane_current_command}],#I #[fg=#826bac][#{pane_current_command}]}} , #{?#{==:#{session_name},float},#[fg=#f5919b],#{?#{==:#{session_name},ephemeral},#[fg=#92a2d5],}}#I [#{pane_current_command}] }}}"

set -g window-status-format "#{?#{e|<:#{client_width},50}, #[fg=#a9b1d6]#I ,#[fg=#a9b1d6]#{?#{e|>=:#{client_width},100}, #I #[fg=#656a80][#{pane_current_command}] , #I #[fg=#656a80][#{pane_current_command}] }}"

set -g window-status-separator "#[fg="#a9b1d6"]*"

set -g window-status-current-style "fg=#bb9af7"
set -g window-status-style "fg=#656a80, bg=default"
set -g window-status-last-style "fg=#656a80, bg=default"

set -g window-status-activity-style "fg=#656a80, bg=default"
set -g window-status-bell-style "fg=#a9b1d6,bg=default, bold"

set-option -g status-interval 1

##
## plugins
##

# set -g @plugin 'tmux-plugins/tpm'

set -g @tpm_plugins '               \
   tmux-plugins/tpm                 \
   tmux-plugins/tmux-resurrect      \
   tmux-plugins/tmux-continuum      \
   alexwforsythe/tmux-which-key     \
   wfxr/tmux-fzf-url                \
'

set -g @continuum-restore 'off'
set -g @fzf-url-bind 'u'

# initialize tpm
run -b '~/.tmux/plugins/tpm/tpm'
