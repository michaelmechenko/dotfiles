unbind r
bind r source-file ~/.config/.tmux.conf

unbind C-b
set -g prefix C-Space
bind c new-window -c "#{pane_current_path}"
set -g default-command /bin/zsh
set-option -g renumber-windows on
set -g base-index 1 # start windows numbering at 1
set-option -g mouse on

##
## keybindings
##

set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel 'pbcopy'
set -s copy-command 'pbcopy'

# vim keybinds
setw -g mode-keys vi
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

bind-key -n M-h select-pane -L
bind-key -n M-j select-pane -D
bind-key -n M-k select-pane -U
bind-key -n M-l select-pane -R

# split window
bind-key -n M-J split-window -v -c "#{pane_current_path}"
bind-key -n M-L split-window -h -c "#{pane_current_path}"

# resize panes
bind-key -n M-W resize-pane -U 
bind-key -n M-S resize-pane -D 
bind-key -n M-A resize-pane -L 
bind-key -n M-D resize-pane -R 

# window focus
bind-key -n M-z resize-pane -Z
bind-key -n M-x confirm-before -c z -p "Kill pane? (z/c)" "kill-pane"

# new window
bind-key -n M-e new-window -c "#{pane_current_path}"

# floating terminals
bind-key -n M-f run-shell "~/.config/tmux_scripts/tmuxpopup"
# bind-key -n M-F run-shell "~/.config/tmux_scripts/tmuxpopup-opposite"
bind-key -n M-F if-shell '[ "$(tmux display-message -p "#{session_name}")" = "float" ]' 'switch-client -l' 'switch-client -t float'
bind-key -n M-c run-shell "~/.config/tmux_scripts/tmuxpopup-ephemeral"

# create new window from pane's cwd in session float
bind-key f run-shell 'tmux new-window -t float: -c "$(tmux display-message -p "#{pane_current_path}")" && ~/.config/tmux_scripts/tmuxpopup'

# choose session
bind-key -n M-s run-shell "~/.config/tmux_scripts/tmux-session-ls"
bind-key -n M-w run-shell "~/.config/tmux_scripts/tmux-window-ls"

# tree view popup
bind-key -n M-t run-shell "~/.config/tmux_scripts/tmux-tree-popup"

# mouse click on status-left to choose session
bind-key -n MouseDown3StatusRight run-shell '~/.config/tmux_scripts/tmux-status-session-ls'
bind-key -n MouseDown1StatusRight run-shell '~/.config/tmux_scripts/tmux-status-windows-ls'

# break pane into new window
bind q break-pane\; move-window -r

bind-key -n M-q break-pane \; move-window -r

# send to prev/next window

# next window
bind-key -n M-E if-shell 'tmux has-session -t :+1' 'join-pane -h -t :+1' 'new-window -d -t +1; join-pane -h -t :-1'

# prev window
bind-key -n M-Q if-shell 'tmux has-session -t :-1' 'join-pane -h -t :-1' 'new-window -d -t -1; join-pane -h -t :+1'

# send pane to 'n' window
bind-key -n M-n run-shell "~/.config/tmux_scripts/tmux-pane-to-window"

# send pane to session
bind-key -n M-N run-shell "~/.config/tmux_scripts/tmux-pane-to-session"

# swap windows
bind-key -n M-, swap-window -t -1\; select-window -t -1
bind-key -n M-. swap-window -t +1\; select-window -t +1

# swap panes
bind-key -n M-< swap-pane -U
bind-key -n M-> swap-pane -D

# tree view
# bind-key -n M-W choose-window
# bind-key -n M-S choose-session
bind-key t choose-tree

# main if >=3 panes, even otherwise
bind-key -n M-V if-shell '[ #{window_panes} -gt 2 ]' 'select-layout main-vertical' 'select-layout even-vertical'
bind-key -n M-H if-shell '[ #{window_panes} -gt 2 ]' 'select-layout main-horizontal' 'select-layout even-horizontal'
bind-key -n M-C-v select-layout main--vertical-mirrored
bind-key -n M-C-h select-layout main-horizontal-mirrored
bind-key -n M-v select-layout tiled

bind-key -n M-\; previous-window
bind-key -n M-\' next-window

bind-key -n M-1 select-window -t:=1
bind-key -n M-2 select-window -t:=2
bind-key -n M-3 select-window -t:=3
bind-key -n M-4 select-window -t:=4
bind-key -n M-5 select-window -t:=5
bind-key -n M-6 select-window -t:=6
bind-key -n M-7 select-window -t:=7
bind-key -n M-8 select-window -t:=8
bind-key -n M-9 select-window -t:=9

# switch sessions
bind-key -n M-\: switch-client -p -O index
bind-key -n M-\[ switch-client -p -O index
bind-key -n M-\" switch-client -n -O index
bind-key -n M-\] switch-client -n -O index

# new session
bind-key C command-prompt "new -s '%%'"

##
## status bar
##

set-option -g status-position top
set -g status on

set -g status-style bg=default
set -g status-justify left

set -g status-left-length 200
set -g status-right-length 200

set -g status-left ""
# set -g status-left '#[align=absolute-centre]#[fg=#656a80]`#{?#{==:#{pane_current_path},#{HOME}},~,#{s|$HOME|~|:#{d:pane_current_path}}/#{b:pane_current_path}}`'

# Toggle status-left visibility
bind-key -n M-d if-shell 'test -z "#{status-left}"' \
    'set -g status-left "#[align=absolute-centre]#[fg=#656a80]`#{?#{==:#{pane_current_path},#{HOME}},~,#{s|$HOME|~|:#{d:pane_current_path}}/#{b:pane_current_path}}`"' \
    'set -g status-left ""'

# with dir
# set -g status-right "#[align=left]#[fg=#a9b1d6]* #[fg=#656a80]'#{?#{==:#{pane_current_path},#{HOME}},~,#{s|$HOME|~|:#{d:pane_current_path}}/#{b:pane_current_path}}'#[fg=#656a80]#[align=right]#[fg=#656a80]#S#[none] #[fg=#656a80][#{S:#{?#{window_zoomed_flag},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#bebedb]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#bebedb]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},#{client_session}}, #[fg=#bebedb]#[underscore]*#[none]#[fg=#656a80] , * }}},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#8ba9c1]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#d8647e]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},#{client_session}}, #[fg=#c9b1c9]#[underscore]*#[none]#[fg=#656a80] , * }}}}}]"

set -g status-right "#[fg=#656a80]#S#[none] #[fg=#656a80][#{S:#{?#{window_zoomed_flag},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#bebedb]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#bebedb]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},#{client_session}}, #[fg=#bebedb]#[underscore]*#[none]#[fg=#656a80] , * }}},#{?#{==:#{session_name},float},#{?#{==:#{session_name},#{client_session}}, #[fg=#8ba9c1]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},ephemeral},#{?#{==:#{session_name},#{client_session}}, #[fg=#d8647e]#[underscore]*#[none]#[fg=#656a80] , * },#{?#{==:#{session_name},#{client_session}}, #[fg=#c9b1c9]#[underscore]*#[none]#[fg=#656a80] , * }}}}}]"

# bind-key R rename-window '#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}'
bind-key W command-prompt -I "#W" "rename-window '%%'"
bind-key S command-prompt -I "#S" "rename-session '%%'"

setw -g pane-border-status top
setw -g pane-border-format "#{?pane_active,*-*-*-*-*}"

# setw -g pane-active-border-style "#{?#{==:#{session_name},float},fg=#8ba9c1,#{?#{==:#{session_name},ephemeral},fg=#d8647e ,fg=#c9b1c9}}"
setw -g pane-active-border-style "#{?#{window_zoomed_flag},fg=#bebedb,#{?#{==:#{session_name},float},fg=#8ba9c1,#{?#{==:#{session_name},ephemeral},fg=#d8647e,fg=#bb9dbd}}}"
setw -g pane-border-style "fg=#656a80, dim"
setw -g pane-border-lines "simple" 
setw -g pane-border-indicators "colour"
setw -g pane-scrollbars "off"
setw -g pane-scrollbars-style "fg=#656a80"

setw -g popup-border-lines "rounded"

setw -g message-style "fg=#a9b1d6"
setw -g cursor-style underline
set -g prompt-cursor-colour "#a9b1d6"

##
## window styling
##

# set-option -g automatic-rename on
# set-option -g automatic-rename-format '#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}'

# Set the foreground/background color for the active window
# setw -g window-active-style "bg=#131313"
setw -g window-active-style "bg=terminal"

# Set the foreground/background color for all other windows
# setw -g window-style "bg=#111111"
setw -g window-style "bg=terminal"

# set -g window-status-current-format "#[bold]#{?#{e|>=:#{client_width},100}, #{pane_current_command} #[fg=#bb9dbd]#[none][#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] , [#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] }"
# set -g window-status-format "#[fg=#a9b1d6]#{?#{e|>=:#{client_width},100}, #{pane_current_command} #[fg=#656a80]#[none][#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] , [#{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}}] }"

set -g window-status-current-format "#{?#{e|<:#{client_width},50}, #[bold]#I ,#[bold]#{?#{window_zoomed_flag},#{?#{e|>=:#{client_width},100}, #[fg=#bebedb]#I #[fg=#aeaed1][#{pane_current_command}] , #[fg=#bebedb]#I [#{pane_current_command}] },#{?#{e|>=:#{client_width},100}, #{?#{==:#{session_name},float},#[fg=#8ba9c1]#I #[fg=#8ba9c1][#{pane_current_command}],#{?#{==:#{session_name},ephemeral},#[fg=#d8647e]#I #[fg=#d8647e][#{pane_current_command}],#I #[fg=#bb9dbd][#{pane_current_command}]}} , #{?#{==:#{session_name},float},#[fg=#8ba9c1],#{?#{==:#{session_name},ephemeral},#[fg=#d8647e],}}#I [#{pane_current_command}] }}}"

set -g window-status-format "#{?#{e|<:#{client_width},50}, #[fg=#a9b1d6]#I ,#[fg=#a9b1d6]#{?#{e|>=:#{client_width},600}, #I #[fg=#656a80][#{pane_current_command}] , #I #[fg=#656a80][#{pane_current_command}] }}"

set -g window-status-separator "#[fg="#a9b1d6"]*"

set -g window-status-current-style "fg=#c9b1c9"
set -g window-status-style "fg=#656a80, bg=default"
set -g window-status-last-style "fg=#656a80, bg=default"

set -g window-status-activity-style "fg=#656a80, bg=default"
set -g window-status-bell-style "fg=#a9b1d6,bg=default, bold"

set-option -g status-interval 1

##
## plugins
##

# set -g @plugin 'tmux-plugins/tpm'

# alexwforsythe/tmux-which-key     \

set -g @tpm_plugins '               \
   tmux-plugins/tpm                 \
   tmux-plugins/tmux-sidebar        \
   tmux-plugins/tmux-resurrect      \
   tmux-plugins/tmux-continuum      \
   wfxr/tmux-fzf-url                \
   laktak/extrakto                  \
'

set -g @continuum-restore 'off'
set -g @fzf-url-bind 'u'

bind-key -n M-K run-shell "~/.tmux/plugins/extrakto/scripts/open.sh \"#{pane_id}\""

# default leader tab/backspace for open/focus respectively
set -g @sidebar-tree-position 'right'
set -g @sidebar-tree-command 'eza -L 2 --group-directories-first --tree --color=always'
# set -g @sidebar-tree 'Tab'
# set -g @sidebar-tree-focus 'w'
# set -g @treemux-tree-position 'right'
# set -g @treemux-tree-client 'neo-tree' 

# initialize tpm
run -b '~/.tmux/plugins/tpm/tpm'
